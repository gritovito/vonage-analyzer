{% extends "base.html" %}

{% block title %}Search - Knowledge Hub{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Search</h1>
</div>

<!-- Search Form -->
<div class="search-container">
    <form method="GET" class="search-form">
        <input type="text" name="q" value="{{ query }}" placeholder="Describe the customer's problem..." class="search-input-large" autofocus>
        <select name="type" class="search-type-select">
            <option value="semantic" {% if search_type == 'semantic' %}selected{% endif %}>Semantic Search (AI)</option>
            <option value="text" {% if search_type == 'text' %}selected{% endif %}>Text Search</option>
        </select>
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
</div>

{% if query %}
<!-- Results -->
<div class="search-results">
    {% if results and results.questions %}
        <div class="result-section">
            <h2>{% if results.is_semantic %}Similar Questions{% else %}Matching Questions{% endif %} ({{ results.questions|length }})</h2>
            {% if results.is_semantic %}
            <p class="result-description">Questions semantically similar to your query, ranked by AI similarity score.</p>
            {% endif %}
            <div class="result-list">
                {% for item in results.questions %}
                <div class="result-item {% if results.is_semantic %}semantic-result{% endif %}">
                    {% if results.is_semantic %}
                    <div class="similarity-score">
                        <div class="score-circle" style="--score: {{ item.similarity }}">
                            {{ item.similarity }}%
                        </div>
                        <span class="score-label">match</span>
                    </div>
                    {% endif %}
                    <div class="result-content-area">
                        <a href="{{ url_for('question_detail', question_id=item.id) }}" class="result-title">
                            {{ item.canonical_text }}
                        </a>
                        <div class="result-meta">
                            <span class="cluster-badge" style="background-color: {{ item.cluster_color }}">
                                {{ item.cluster_icon }} {{ item.cluster_name }}
                            </span>
                            <span class="times-asked">{{ item.times_asked }}x asked</span>
                            <span class="status-badge status-{{ item.status }}">{{ item.status }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
    <div class="empty-state">
        <h3>No results found</h3>
        <p>Try different keywords or {% if search_type == 'semantic' %}use text search{% else %}use semantic search{% endif %}.</p>
    </div>
    {% endif %}
</div>
{% else %}
<!-- Search Tips -->
<div class="search-tips">
    <h2>Search Tips</h2>
    <ul>
        <li><strong>Semantic Search (AI):</strong> Describe the problem in natural language. Our AI will find questions with similar meaning.</li>
        <li><strong>Text Search:</strong> Find exact keyword matches in questions.</li>
        <li>Example: "phone won't turn on" will match "device not powering up" in semantic search.</li>
    </ul>
</div>
{% endif %}
{% endblock %}

{% block head %}
<style>
.search-type-select {
    padding: 1rem;
    font-size: 1rem;
    border: 2px solid #ddd;
    border-radius: 8px;
    background: white;
    min-width: 180px;
}

.result-description {
    color: #666;
    margin-bottom: 1rem;
    font-size: 0.9rem;
}

.semantic-result {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
}

.similarity-score {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 70px;
}

.score-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.9rem;
    background: conic-gradient(
        #4a90d9 calc(var(--score) * 1%),
        #e9ecef calc(var(--score) * 1%)
    );
    position: relative;
}

.score-circle::before {
    content: '';
    position: absolute;
    width: 50px;
    height: 50px;
    background: white;
    border-radius: 50%;
}

.score-label {
    font-size: 0.75rem;
    color: #888;
    margin-top: 0.25rem;
}

.result-content-area {
    flex: 1;
}

.result-content-area .result-title {
    font-size: 1.1rem;
    display: block;
    margin-bottom: 0.5rem;
}
</style>
{% endblock %}
